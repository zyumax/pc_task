コードに含まれている問題点
- 年間1つまでのバリデーションが入っていない
- PurchaseServiceクラスの中に、商品取得と購入手続きが一緒になっている(責務の分離をするべき)

以下、アプリ側、SQL側どちらで絞り込む？<br>
アプリ側<br>
取得した商品データを複数の条件で使い回す際、アプリ側でバリデーションをかけた方が簡単に思える
しかし、データを一度に取得する際に、データ数が多いと動作が重くなる

SQL側<br>
データを選別してから取得するので、動作は軽くなる。
今回のケースだと、プレミアム会員を取得すると想定した場合、JOINが必要になる。一つだけのJOINならいいが、複数JOINする場合、SQLが複雑になりそう

<br>
今回のコード改修では、1人のユーザーが数千件も購入しないと仮定して、購入した商品を全て取得してからバリデーションをかけることにした
