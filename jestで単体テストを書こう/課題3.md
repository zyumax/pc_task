## 課題3(質問)

### 課題3-1
課題2の単体テストを書くためには、依存性の注入とモック化を行う必要がありました。
そもそも、なぜ元の関数はカバレッジ100%のテストを書けなかったのでしょうか？
- DatabaseMockが直接インスタンス化されていて、モック化できない。そのため、成功と失敗の処理を分けて書くことができない
- nameApiServiceが直接インスタンス化されていて、モック化できない。APIから直接値を取ってくるので、レスポンスの内容でテスト結果が変わってしまう。  
`if (firstName.length > maxNameLength)`の中身も設定できないので、if文の分岐処理を書けない

### 課題3-2
依存性の注入とは何でしょうか？どのような問題を解決するために考案されたのでしょうか？
- ソフトウェアのデザインパターンの1つ。関数内部で依存先をインスタンス化するのではなく、外から依存先のインスタンスを使用できるようにすること。  

目的
- テストがしやすくなる
    - モックが簡単に書けるようになるので、特定の値を作りやすくなる
- コードを再利用しやすくなる
    - クラスの再利用が柔軟にできる
- 責務の切り分けが容易になり、メンテナンスがしやすくなる

### 課題3-3
`getFirstNameThrowIfLong`の関数はhttps://random-data-api.comからデータを取得しているようです。しかしテストの度に外部サービスと通信をするようでは、良い単体テストにならない可能性があります。今回のような単体テストで外部サービスとの通信が発生すると、どのようなデメリットがあるでしょうか？
- テストの実行速度が重くなる可能性がある
- 外部サービスを使用するときに、使用制限や料金がかかってしまう可能性がある
- 外部データに依存するため、取得する値が変わりテストがやりにくい


### 課題3-4 *任意
テストには「単体テスト」「統合テスト」など様々な分類や定義があります。
チーム内で「何を単体テストと呼ぶのか」「何を統合テストと呼ぶのか」など用語の定義集を作ってみても面白いかもしれません。
- 単体テスト
     - システム開発のテストで最初に行う
     - システムのひとまとまりの機能や画面などの小さな単位1つ1つを対象にして行うテスト
     - モジュールや個々のコンポーネントが正しく機能するかを確認する
- 統合テスト(結合テスト)
    - 単体テスト完了後に行う
    - 機能や画面を複数にわたり行き来するような動作を確認するテスト
    - 結合テストを行うことで、複数の機能や画面が連携して行う動作に不具合がないかを確認することができる

### 課題3-5,6
sumOfArrayに空の配列を渡すと例外が発生します。あまり好ましい挙動ではありません。
なぜあまり好ましい挙動ではないのでしょうか？
「こうなるべきだ」とご自身が考える形にコードを修正してみてください。

コードを修正したら、先ほど書いた単体テストが落ちるはずです。
全ての単体テストが通るよう、単体テストも修正してください。
- なぜ好ましくないのか？
    - 例外が発生するとプログラムが異常終了してしまう可能性がある
    - 例外が発生した場合に、ユーザーにエラーメッセージを表示するなどした方がわかりやすい

コード修正  
https://github.com/zyumax/praha-challenge-templates/pull/3

### 課題3-7
単体テストを作成する際は、挙動が変わる境界値を検討したり、テストで保証しなければならない挙動を開発者自身が事前に考えておく必要があります。しかし複雑な機能をテストする場合あらかじめ全てのテストケースを開発者が想定しきることは難しいかもしれません。

「この特定の値の時だけ不具合が起きる」ケースを開発者が見落としてしまうと、テストケースが不完全になってしまいます。そんな時に役立つかもしれない概念として「Property Based Testing（プロパティベースのテスト）」があります（対照的な存在としてはExample Based Testingが挙げられます）。

なぜこのテストの考え方がコード品質を向上してくれる可能性があるのでしょうか？
逆に採用しない方が良いケースはあるのでしょうか？

#### Property Based Testing（プロパティベースのテスト）
「システムのあるべき挙動を満たす条件」をプロパティと呼び、入力をランダムに自動生成し実行して、プロパティを満たしていることを確認するテスト

#### Example Based Testing
従来のテスト方法。「この入力値にはこの出力を返す」を確認するテスト

#### PBTでコード品質を向上させるケース
- 開発者が想定していない入力パターンをテストできる
- 多様なテストケースを網羅的に行える
- バグを発見しやすくなる

#### PBTを採用しない方が良いケース
- テストの実行時間に制約がある場合。テストの実行時間が長くなる可能性がある。
- 具体定なパラメーターが決まってる場合は、EBTの方が良い。プロパティの定義が難しいので。


### 課題3-8
単体テストケースを増やしても可読性、保守性、実行速度などに問題が起きないよう工夫できることを3つ考えてみましょう。
例: `arrange-act-assert`パターンを採用する、など

- `Given-When-Then`パターンを採用する
- 一つのテストケースには、一つの検証を行う
    - テスト失敗時に原因が明確になる
- テストコードだけを見て何が行われているかわかるように書く。他人が見ても分かるように意識する。
- 繰り返し実行する必要がある箇所は、beforeEachフックなどを用いて共通化する
